<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Motivations for clock • clock</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Motivations for clock">
<script defer data-domain="clock.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clock</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.7.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/clock.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/faq.html">Frequently Asked Questions</a></li>
    <li><a class="dropdown-item" href="../articles/motivations.html">Motivations for clock</a></li>
    <li><a class="dropdown-item" href="../articles/recipes.html">Examples and Recipes</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/03/clock-0-1-0/">Version 0.1.0</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/clock/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Motivations for clock</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/clock/blob/main/vignettes/articles/motivations.Rmd" class="external-link"><code>vignettes/articles/motivations.Rmd</code></a></small>
      <div class="d-none name"><code>motivations.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://clock.r-lib.org">clock</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rlang.r-lib.org" class="external-link">rlang</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="motivations">Motivations<a class="anchor" aria-label="anchor" href="#motivations"></a>
</h2>
<p>R has always had strong date and date-time capabilities. The Date,
POSIXct, and POSIXlt classes provide a powerful foundation to build on,
and the R community has done just that. <a href="https://lubridate.tidyverse.org/" class="external-link">lubridate</a>, <a href="https://CRAN.R-project.org/package=zoo" class="external-link">zoo</a>, and <a href="https://CRAN.R-project.org/package=tsibble" class="external-link">tsibble</a> are just a
few of the popular packages that have extended R’s native date-time
capabilities.</p>
<p>So, why clock?</p>
<p>The following are a few of clock’s goals:</p>
<ul>
<li><p>Explicitly handle invalid dates</p></li>
<li><p>Explicitly handle daylight saving time issues</p></li>
<li><p>Expose naive types for representing date-times without a time
zone</p></li>
<li><p>Provide calendar types for representing calendar “dates” in
alternative ways</p></li>
<li><p>Provide variable precision date-time types</p></li>
</ul>
<p>Dealing with dates and date-times is difficult enough as it is.
clock’s overarching mission is to accomplish its goals in the most
explicit and unambiguous way possible. It does this through a
combination of:</p>
<ul>
<li><p>Erroring early and verbosely</p></li>
<li><p>Requiring named optional arguments everywhere</p></li>
<li><p>Providing an optional “strict” mode for production systems that
forces you to explicitly type out your assumptions for invalid dates and
daylight saving time issues</p></li>
</ul>
<p>You might also be wondering, why not add these features to lubridate
instead? While clock’s high-level API and lubridate have similar overall
scopes and feel, they are powered by two very different systems. The way
that you solve problems with clock is often very different from what you
might do with lubridate. Merging this new system into lubridate would be
a very difficult task, and would involve many backwards incompatible
changes. Additionally, clock’s low-level API provides new types and
capabilities that are out of scope even for lubridate, which focuses on
R’s native date-time types.</p>
<p>The rest of this vignette investigates each of clock’s goals in more
detail. Where relevant, a comparison against lubridate is made to
demonstrate some of the improvements and consistency that come with
clock.</p>
<p>Parts of this document are extremely detailed, and can get very
technical. They are included to provide examples of tough date-time
manipulation problems that I feel are under-discussed, but feel free to
skip around.</p>
<div class="section level3">
<h3 id="invalid-dates">Invalid dates<a class="anchor" aria-label="anchor" href="#invalid-dates"></a>
</h3>
<div class="section level4">
<h4 id="dates">Dates<a class="anchor" aria-label="anchor" href="#dates"></a>
</h4>
<p>What is 1 month after January 31st, 2020? Let’s ask lubridate:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2020-01-31"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-01-29" "2020-01-30" "2020-01-31" "2020-02-01"</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" NA           NA           "2020-03-01"</span></span></code></pre></div>
<p>In this example, we’ve asked lubridate to create two <em>invalid
dates</em>, <code>2020-02-30</code> and <code>2020-02-31</code>. Invalid
dates often arise with month-based arithmetic, but they also arise when
forcibly setting the month to a specific value. Because these dates
don’t exist, lubridate returns <code>NA</code>. When working with time
series, it is often more useful to return <em>something</em> back, but
what? We could:</p>
<ul>
<li><p>Return <code>NA</code> as lubridate does</p></li>
<li><p>Return the previous valid moment in time</p></li>
<li><p>Return the next valid moment in time</p></li>
<li><p>Overflow our invalid date into March by the number of days past
the true end of February that it landed at</p></li>
</ul>
<p>Only the first is available to you with <code>+ months(1)</code>. To
supplement this, lubridate added <code>%m+%</code> and
<code><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Equivalent to `add_with_rollback(x, months(1))`</span></span>
<span><span class="va">x</span> <span class="op"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">%m+%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" "2020-02-29" "2020-02-29" "2020-03-01"</span></span>
<span></span>
<span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, roll_to_first <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" "2020-03-01" "2020-03-01" "2020-03-01"</span></span></code></pre></div>
<p>With Dates, the hardest part about <code>%m+%</code> is remembering
to use it. It is a common bug to forget to use this helper until
<em>after</em> you have been bitten by an invalid date issue with an
unexpected <code>NA</code>.</p>
<p>In clock, invalid dates must be handled explicitly as they occur. The
default behavior raises an error.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `invalid_resolve()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid date found at location 2.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve invalid date issues by specifying the `invalid` argument.</span></span></code></pre></div>
<p>You can handle these issues with an <em>invalid date resolution
strategy</em>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Previous moment in time</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" "2020-02-29" "2020-02-29" "2020-03-01"</span></span>
<span></span>
<span><span class="co"># Next moment in time</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"next"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" "2020-03-01" "2020-03-01" "2020-03-01"</span></span>
<span></span>
<span><span class="co"># Overflow by 1 day for 30th, 2 days for 31st</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"overflow"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" "2020-03-01" "2020-03-02" "2020-03-01"</span></span>
<span></span>
<span><span class="co"># Like lubridate</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29" NA           NA           "2020-03-01"</span></span></code></pre></div>
<p>I recommend using either <code>"previous"</code> or
<code>"next"</code> at all times. Overflowing can be useful in certain
scenarios, but it can also result in losing the relative ordering of
your input. In the previous example, note that <code>x</code> is no
longer sorted after adding 1 month when using <code>"overflow"</code>.
If your analysis requires a (weakly) increasing sequence of dates, as
many time series analyses do, then you should use
<code>"previous"</code> or <code>"next"</code>, which are guaranteed to
maintain relative ordering.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"overflow"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 4 3</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="date-times">Date-times<a class="anchor" aria-label="anchor" href="#date-times"></a>
</h4>
<p>With date-times, when you hit invalid dates you also have to consider
what to do with the time of day.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2020-01-31"</span>, <span class="st">"America/New_York"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-arithmetic.html">add_hours</a></span><span class="op">(</span><span class="fl">4</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-01-29 04:00:00 EST" "2020-01-30 03:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-01-31 02:00:00 EST" "2020-02-01 01:00:00 EST"</span></span></code></pre></div>
<p><code><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback()</a></code> defaults to preserving the time of
day. Invalid dates are rolled back to the previous valid <em>day</em>,
but the time of day of <code>x</code> is kept:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-02-29 03:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-02-29 02:00:00 EST" "2020-03-01 01:00:00 EST"</span></span></code></pre></div>
<p>I think this is dangerous for the same reason I advised not using
<code>"overflow"</code> in the Date section above. You can easily lose
the relative ordering within <code>x</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 3 2 1 4</span></span></code></pre></div>
<p><code><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback()</a></code> has a <code>preserve_hms</code>
argument, but this can’t help here, as it just sets the time of day to
midnight and the ordering is still lost.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, preserve_hms <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-02-29 00:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-02-29 00:00:00 EST" "2020-03-01 01:00:00 EST"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>, preserve_hms <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2 3 1 4</span></span></code></pre></div>
<p>With clock, using <code>"previous"</code> and <code>"next"</code>
will use the previous and next valid <em>moment in time</em>. With
POSIXct (which clock assumes to have second precision), this chooses the
previous and next valid second. This is the only way to preserve
relative ordering in <code>x</code>, which is another reason I advocate
for using these options.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-02-29 23:59:59 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-02-29 23:59:59 EST" "2020-03-01 01:00:00 EST"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"next"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-03-01 00:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-03-01 00:00:00 EST" "2020-03-01 01:00:00 EST"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"next"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4</span></span></code></pre></div>
<p>If you really want lubridate’s <code><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback()</a></code>
behavior of retaining the time of day, you can use
<code>"previous-day"</code> and <code>"next-day"</code>, which only
adjust the day component, leaving the time of day intact. Again, I don’t
recommend this.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"previous-day"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-02-29 03:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-02-29 02:00:00 EST" "2020-03-01 01:00:00 EST"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, invalid <span class="op">=</span> <span class="st">"next-day"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-02-29 04:00:00 EST" "2020-03-01 03:00:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-03-01 02:00:00 EST" "2020-03-01 01:00:00 EST"</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="daylight-saving-time">Daylight saving time<a class="anchor" aria-label="anchor" href="#daylight-saving-time"></a>
</h3>
<p>In general, there are two types of daylight saving time issues that
might come up with dealing with date-times:</p>
<ul>
<li><p>Nonexistent times due to daylight saving time gaps</p></li>
<li><p>Ambiguous times due to daylight saving time fallbacks</p></li>
</ul>
<div class="section level4">
<h4 id="nonexistent-time">Nonexistent time<a class="anchor" aria-label="anchor" href="#nonexistent-time"></a>
</h4>
<p>On March 8th, 2020 in New York (the America/New_York time zone), the
clocks jumped forward from <code>01:59:59</code> to
<code>03:00:00</code>. This created a daylight saving time gap,
resulting in a <em>nonexistent</em> 2 o’clock hour. These daylight
saving time gaps happen once a year in a large number of time zones
around the world. Luckily, they often happen at irregular times, like 2
AM, so they often don’t interfere with your analyses. That said, it is
entirely possible that you could find yourself landing in one of these
gaps, so it is important to know how to deal with them.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1 day before the gap</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date-time-parse.html">date_time_parse</a></span><span class="op">(</span></span>
<span>  <span class="st">"March 7, 2020 02:30:00"</span>, <span class="st">"America/New_York"</span>, </span>
<span>  format <span class="op">=</span> <span class="st">"%B %d, %Y %H:%M:%S"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clock-arithmetic.html">add_minutes</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">45</span>, <span class="fl">0</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-03-07 01:45:00 EST" "2020-03-07 02:30:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-03-07 03:15:00 EST"</span></span></code></pre></div>
<p>Let’s try adding 1 day to these times with lubridate. As you might
expect, you get an <code>NA</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">days</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" NA                       </span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span></code></pre></div>
<p>Unlike with invalid dates, there aren’t any tools like
<code><a href="https://lubridate.tidyverse.org/reference/mplus.html" class="external-link">add_with_rollback()</a></code> to help you out here. You’re stuck with
the <code>NA</code>. But what could you do? Possibly:</p>
<ul>
<li><p>Roll forward to the next valid moment in time</p></li>
<li><p>Roll backward to the previous valid moment in time</p></li>
<li><p>Shift forward by the size of the gap</p></li>
<li><p>Shift backward by the size of the gap</p></li>
<li><p>Return <code>NA</code></p></li>
</ul>
<p>clock allows you to do all of these things. By default, nonexistent
times result in an error.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Nonexistent time due to daylight saving time at location 2.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve nonexistent time issues by specifying the `nonexistent` argument.</span></span></code></pre></div>
<p>Solve these issues with a <em>nonexistent time resolution
strategy</em>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 02:30:00 -&gt; 03:00:00</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"roll-forward"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" "2020-03-08 03:00:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span>
<span></span>
<span><span class="co"># 02:30:00 -&gt; 01:59:59</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"roll-backward"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" "2020-03-08 01:59:59 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span>
<span></span>
<span><span class="co"># 02:30:00 + gap of 1 hr = 03:30:00</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"shift-forward"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" "2020-03-08 03:30:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span>
<span></span>
<span><span class="co"># 02:30:00 - gap of 1 hr = 01:30:00</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"shift-backward"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" "2020-03-08 01:30:00 EST"</span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span>
<span></span>
<span><span class="co"># lubridate behavior</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 01:45:00 EST" NA                       </span></span>
<span><span class="co">#&gt; [3] "2020-03-08 03:15:00 EDT"</span></span></code></pre></div>
<p>I recommend using <code>"roll-forward"</code> and
<code>"roll-backward"</code>, as they are guaranteed to retain the
relative ordering of <code>x</code>. Shifting, while sometimes useful,
will not always retain this:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 2 3</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="../reference/clock-arithmetic.html">add_days</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, nonexistent <span class="op">=</span> <span class="st">"shift-forward"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 3 2</span></span></code></pre></div>
<p>When doing arithmetic with clock’s high-level API, you’ll only
encounter these nonexistent time issues when adding “large” units of
time, like days, months, or years. Adding hours, minutes, or seconds
will first convert to UTC, add the units of time there, and then convert
back to your original time zone, which never creates any problematic
times. This might sound a bit strange, but it is generally what you want
when working with these smaller units of time.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1 second before the gap</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date-time-parse.html">date_time_parse</a></span><span class="op">(</span></span>
<span>  <span class="st">"March 8, 2020 01:59:59"</span>, <span class="st">"America/New_York"</span>, </span>
<span>  format <span class="op">=</span> <span class="st">"%B %d, %Y %H:%M:%S"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_seconds</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 03:00:00 EDT"</span></span></code></pre></div>
<p>This is essentially equivalent to using <code><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">dseconds()</a></code> from
lubridate. Note that adding <code><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">seconds()</a></code> would “land” you in
the gap, but <code><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">dseconds()</a></code> jumps right over it.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">seconds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/duration.html" class="external-link">dseconds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 03:00:00 EDT"</span></span></code></pre></div>
<p>If for any reason you want the <code>+ seconds()</code> behavior, you
can manually take control by converting to naive-time, adding the units
of time there, and then converting back to POSIXct.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-arithmetic.html">add_seconds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="../reference/date-time-zone.html">date_time_zone</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Nonexistent time due to daylight saving time at location 1.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve nonexistent time issues by specifying the `nonexistent` argument.</span></span>
<span></span>
<span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-arithmetic.html">add_seconds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="../reference/date-time-zone.html">date_time_zone</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, nonexistent <span class="op">=</span> <span class="st">"roll-forward"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-03-08 03:00:00 EDT"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ambiguous-time">Ambiguous time<a class="anchor" aria-label="anchor" href="#ambiguous-time"></a>
</h4>
<p>On November 1st, 2020 in New York (the America/New_York time zone),
the clocks fell backwards from <code>01:59:59 EDT</code> to
<code>01:00:00 EST</code>. This created a daylight saving time fallback,
resulting in two 1 o’clock hours. Without prior knowledge about whether
the daylight time or standard time 1 o’clock should be used, times that
fall in the two 1 o’clock hours are considered <em>ambiguous</em>.</p>
<p>Like with nonexistent times, adding hours, minutes, or seconds with
the high-level API won’t generate ambiguous time issues, as it always
adds a fixed duration of seconds to the underlying numeric
representation of your date-time. This gives us an easy way to show the
two 1 o’clocks:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date-time-parse.html">date_time_parse</a></span><span class="op">(</span><span class="st">"2020-11-01 00:59:59"</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The first 1 o'clock</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_seconds</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:00:00 EDT"</span></span>
<span></span>
<span><span class="co"># The second 1 o'clock</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_seconds</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">3601</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:00:00 EST"</span></span></code></pre></div>
<p>If we instead worked with units of months, it would be possible to
generate an ambiguous time:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1 month before the two ambiguous times</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date-time-parse.html">date_time_parse</a></span><span class="op">(</span><span class="st">"2020-10-01 01:30:00"</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Which of the two 1 o'clocks are we talking about? It is ambiguous!</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Ambiguous time due to daylight saving time at location 1.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve ambiguous time issues by specifying the `ambiguous` argument.</span></span></code></pre></div>
<p>You can handle these by setting an <em>ambiguous time resolution
strategy</em>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The 1 o'clock that is earliest in the timeline</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, ambiguous <span class="op">=</span> <span class="st">"earliest"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EDT"</span></span>
<span></span>
<span><span class="co"># The 1 o'clock that is latest in the timeline</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, ambiguous <span class="op">=</span> <span class="st">"latest"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EST"</span></span>
<span></span>
<span><span class="co"># Ambiguous times should return NA</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">1</span>, ambiguous <span class="op">=</span> <span class="st">"NA"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] NA</span></span></code></pre></div>
<p>The lubridate behavior here is a bit tricky to explain. In some
examples, it might seem to give a more obvious answer:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1 month after the fallback</span></span>
<span><span class="va">x_after</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start before the fallback, add time, return the earliest ambiguous time</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-10-01 01:30:00 EDT"</span></span>
<span><span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EDT"</span></span>
<span></span>
<span><span class="co"># Start after the fallback, subtract time, return the latest ambiguous time</span></span>
<span><span class="va">x_after</span></span>
<span><span class="co">#&gt; [1] "2020-12-01 01:30:00 EST"</span></span>
<span><span class="va">x_after</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EDT"</span></span></code></pre></div>
<p>But with other examples, you can end up with confusing results:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_year_before</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_year_after</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Start before the fallback, add time, return the earliest ambiguous time</span></span>
<span><span class="va">x_year_before</span></span>
<span><span class="co">#&gt; [1] "2019-11-01 01:30:00 EDT"</span></span>
<span><span class="va">x_year_before</span> <span class="op">+</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EDT"</span></span>
<span></span>
<span><span class="co"># Start after the fallback, subtract time, return the...earliest ambiguous time?</span></span>
<span><span class="va">x_year_after</span></span>
<span><span class="co">#&gt; [1] "2021-11-01 01:30:00 EDT"</span></span>
<span><span class="va">x_year_after</span> <span class="op">-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/period.html" class="external-link">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:30:00 EDT"</span></span></code></pre></div>
<p>When lubridate hits an ambiguous time, the UTC offset of the result
always matches the offset of the original input. Sometimes this makes
sense, but often when adding larger periods of time or updating multiple
components of a date-time, this can be confusing.</p>
<p>This isn’t to say that the lubridate behavior is wrong. I would argue
that it is just a bit too lenient. In clock, a slightly modified form of
this behavior exists that is a bit stricter. Consider what would happen
if you tried to floor these dates to the nearest hour:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="st">"2020-11-01 00:30:00"</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clock-arithmetic.html">add_hours</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 00:30:00 EDT" "2020-11-01 01:30:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2020-11-01 01:30:00 EST" "2020-11-01 02:30:00 EST"</span></span>
<span><span class="co">#&gt; [5] "2020-11-01 03:30:00 EST" "2020-11-01 04:30:00 EST"</span></span></code></pre></div>
<p>Notice that if we converted two of these dates to naive-time, and
then tried to convert them back to POSIXct, they would have been
considered ambiguous.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.POSIXlt.html" class="external-link">as.POSIXct</a></span><span class="op">(</span><span class="fu"><a href="../reference/date-time-zone.html">date_time_zone</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Ambiguous time due to daylight saving time at location 2.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve ambiguous time issues by specifying the `ambiguous` argument.</span></span></code></pre></div>
<p><code><a href="../reference/date-and-date-time-rounding.html">date_floor()</a></code> works by flooring while in naive-time, but
somehow this still produces the results you probably expected, with the
two 1 o’clock hours being kept in separate groups:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/date-and-date-time-rounding.html">date_floor</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 00:00:00 EDT" "2020-11-01 01:00:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2020-11-01 01:00:00 EST" "2020-11-01 02:00:00 EST"</span></span>
<span><span class="co">#&gt; [5] "2020-11-01 03:00:00 EST" "2020-11-01 04:00:00 EST"</span></span></code></pre></div>
<p>If you look carefully at the documentation for the POSIXct method of
<code><a href="../reference/date-and-date-time-rounding.html">date_floor()</a></code>, you’ll notice that <code>ambiguous</code>
actually defaults to <code>x</code>. When ambiguous times occur and your
<code>ambiguous</code> argument is set to a date-time, clock will
attempt to use information from that date-time to determine how to
resolve the ambiguity. To resolve ambiguity using a date-time
<code>ambiguous</code> value, the following two conditions must be
met:</p>
<ul>
<li><p>If <code>ambiguous</code> was converted to naive-time, then back
to POSIXct, it must be considered ambiguous.</p></li>
<li><p>The transition point of the ambiguous naive-time implied by
<code>ambiguous</code> and the naive-time that results from the
operation you are performing must be the same.</p></li>
</ul>
<p>In the above example, both of these bullet points are true (the
transition point of interest is <code>2020-11-01 01:00:00-05:00</code>,
the first valid moment in time after the fallback), which allows
<code><a href="../reference/date-and-date-time-rounding.html">date_floor()</a></code> to resolve the ambiguity “automatically”
without any user intervention.</p>
<p>As a final example, let’s change the <code>origin</code> that we
floor relative to to be 1am EDT, and then let’s floor by two hours. This
should generate hour groups of <code>[1, 3), [3, 5), ...</code> .</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/date-and-date-time-rounding.html">date_floor</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="va">origin</span></span>
<span><span class="co">#&gt; [1] "2020-11-01 01:00:00 EDT"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/date-and-date-time-rounding.html">date_floor</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"hour"</span>, n <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="va">origin</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Ambiguous time due to daylight saving time at location 4.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve ambiguous time issues by specifying the `ambiguous` argument.</span></span></code></pre></div>
<p>It seems that we have an ambiguous time issue at location 4, the
<code>02:30:00</code> time. Flooring this to every two hours with an
origin of 1 o’clock places it in the <code>01:00:00</code> group, but
trying to convert that back to POSIXct fails. Unlike when flooring by a
single hour, here we have an original time that would <em>not</em> have
been considered ambiguous if converted to naive-time and back (bullet
point 1 above). This implies that we cannot use information from
<code>ambiguous</code> to resolve this new ambiguity.</p>
<p>To solve this, ideally we’d be able to manually fix the ambiguity
that <code>02:30:00</code> introduced while maintaining the automatic
ambiguity resolution behavior for the <code>01:30:00 EDT</code> and
<code>01:30:00 EST</code> date-times. To handle both of these issues at
once, you can supply a list for <code>ambiguous</code> where the first
element is <code>x</code> and the second is an ambiguous time resolution
strategy to use when <code>x</code> isn’t enough to solve the
ambiguity.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># [23, 1 EDT), [1 EDT, 1 EST), [1 EST, 3), [3, 5)</span></span>
<span><span class="fu"><a href="../reference/date-and-date-time-rounding.html">date_floor</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"hour"</span>, n <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="va">origin</span>, ambiguous <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"latest"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "2020-10-31 23:00:00 EDT" "2020-11-01 01:00:00 EDT"</span></span>
<span><span class="co">#&gt; [3] "2020-11-01 01:00:00 EST" "2020-11-01 01:00:00 EST"</span></span>
<span><span class="co">#&gt; [5] "2020-11-01 03:00:00 EST" "2020-11-01 03:00:00 EST"</span></span></code></pre></div>
<p>You end up with a grouping that contains only a single hour of
information (1 EDT), but this is probably the best that we can do since
it maintains the rest of the expected grouping structure before and
after the fallback.</p>
</div>
</div>
<div class="section level3">
<h3 id="production">Production<a class="anchor" aria-label="anchor" href="#production"></a>
</h3>
<p>This new invalid date and daylight saving time behavior might sound
great to you, but you might be wondering about usage of clock in
production. What happens if <code><a href="../reference/clock-arithmetic.html">add_months()</a></code> worked in
interactive development, but then you put your analysis into production,
gathered new data, and all of the sudden it started failing?</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2020-03-30"</span>, <span class="st">"2020-03-31"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1] "2020-03-30" "2020-03-31"</span></span>
<span></span>
<span><span class="co"># All good! Ship it!</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="co">#&gt; [1] "2020-04-30"</span></span>
<span></span>
<span><span class="co"># Got new production data. Oh no!</span></span>
<span><span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `invalid_resolve()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid date found at location 2.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve invalid date issues by specifying the `invalid` argument.</span></span></code></pre></div>
<p>To balance the usefulness of clock in interactive development with
the strict requirements of production, you can set the
<code>clock.strict</code> global option to <code>TRUE</code> to turn
<code>invalid</code>, <code>nonexistent</code>, and
<code>ambiguous</code> from optional arguments into required ones.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rlang.r-lib.org/reference/local_options.html" class="external-link">with_options</a></span><span class="op">(</span>clock.strict <span class="op">=</span> <span class="cn">TRUE</span>, .expr <span class="op">=</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="../reference/clock-arithmetic.html">add_months</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `strict_validate_invalid()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> The global option, `clock.strict`, is currently set to `TRUE`. In this mode, `invalid` must be set and cannot be left as `NULL`.</span></span></code></pre></div>
<p>Forcing yourself to specify these arguments up front during
interactive development is a great way to explicitly document your
assumptions about these possible issues, while also guarding against
future problems in production.</p>
</div>
<div class="section level3">
<h3 id="naive-time">Naive-time<a class="anchor" aria-label="anchor" href="#naive-time"></a>
</h3>
<p>The previous section was entirely focused on issues that might arise
when working with POSIXct and time zones. If you don’t require the
complexity of time zones, you can use a naive-time. Naive-times are a
type of time point that have a yet-to-be-specified time zone. The other
type of time point in clock is a sys-time, which is interpreted as
having a UTC time zone attached to it. If you aren’t using time zones at
all, naive-times and sys-times are equivalent, and even use the same
date algorithms under the hood.</p>
<p>Unlike our ambiguous time examples from before, since naive-times
don’t have any implied time zone, there is no repeated 1 o’clock
hour.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/naive_time_parse.html">naive_time_parse</a></span><span class="op">(</span><span class="st">"2020-11-01T00:30:00"</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clock-arithmetic.html">add_hours</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">0</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;second&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00" "2020-11-01T01:30:00" "2020-11-01T02:30:00"</span></span>
<span><span class="co">#&gt; [4] "2020-11-01T03:30:00" "2020-11-01T04:30:00" "2020-11-01T05:30:00"</span></span></code></pre></div>
<p>This makes arithmetic and flooring much simpler to reason about:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/time-point-rounding.html">time_point_floor</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;hour&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00" "2020-11-01T01" "2020-11-01T02" "2020-11-01T03"</span></span>
<span><span class="co">#&gt; [5] "2020-11-01T04" "2020-11-01T05"</span></span>
<span></span>
<span><span class="va">origin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/time_point_cast.html">time_point_cast</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"hour"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/time-point-rounding.html">time_point_floor</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"hour"</span>, n <span class="op">=</span> <span class="fl">2</span>, origin <span class="op">=</span> <span class="va">origin</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;hour&gt;[6]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-10-31T23" "2020-11-01T01" "2020-11-01T01" "2020-11-01T03"</span></span>
<span><span class="co">#&gt; [5] "2020-11-01T03" "2020-11-01T05"</span></span></code></pre></div>
<p>You’ll notice that the result of flooring by hour is a time point
with <em>hour</em> precision. Flooring drops all information at more
precise precisions, and the result is represented in a more compact
form.</p>
<p>The difference between naive-time and sys-time is only important when
you are working with time zones and zoned-times / POSIXct. Since
naive-time has a yet-to-be-specified time zone, converting to a
zoned-time simply specifies that zone. If possible, it keeps the printed
time the same, while changing the underlying duration.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;second&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_zoned_time.html">as_zoned_time</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;zoned_time&lt;second&gt;&lt;America/New_York&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00-04:00"</span></span></code></pre></div>
<p>Sys-time is interpreted as being UTC. Converting it to a zoned-time
will keep the underlying duration, but will change the printed time.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_sys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_sys_time.html">as_sys_time</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">x_sys</span></span>
<span><span class="co">#&gt; &lt;sys_time&lt;second&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00"</span></span>
<span></span>
<span><span class="co"># Subtract 4 hours to print the America/New_York time</span></span>
<span><span class="fu"><a href="../reference/as_zoned_time.html">as_zoned_time</a></span><span class="op">(</span><span class="va">x_sys</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;zoned_time&lt;second&gt;&lt;America/New_York&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-10-31T20:30:00-04:00"</span></span></code></pre></div>
<p>Converting from sys-time to zoned-time won’t ever have any issues
with nonexistent or ambiguous times, but converting from naive-time
might. Remember that there were two 1 o’clock hours on this day in the
America/New_York time zone.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;second&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00" "2020-11-01T01:30:00"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_zoned_time.html">as_zoned_time</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"America/New_York"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_zoned_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Ambiguous time due to daylight saving time at location 2.</span></span>
<span><span class="co">#&gt; <span style="color: #0000BB;">ℹ</span> Resolve ambiguous time issues by specifying the `ambiguous` argument.</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_zoned_time.html">as_zoned_time</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="st">"America/New_York"</span>, ambiguous <span class="op">=</span> <span class="st">"earliest"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;zoned_time&lt;second&gt;&lt;America/New_York&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-11-01T00:30:00-04:00" "2020-11-01T01:30:00-04:00"</span></span></code></pre></div>
<p>In the low-level API, converting from naive-time to zoned-time is
actually the <em>only</em> place where the <code>nonexistent</code> and
<code>ambiguous</code> arguments are used. This limits how often you
have to think about daylight saving time, ideally helping you avoid as
many subtle bugs as possible. In the high-level API for POSIXct, these
arguments are forced to bubble up in more places. This trades the user
benefit of being able to work directly on R’s native date-time types for
the side-effect of potentially having to deal with these issues in more
places.</p>
</div>
<div class="section level3">
<h3 id="calendar-types">Calendar types<a class="anchor" aria-label="anchor" href="#calendar-types"></a>
</h3>
<p>clock provides multiple new <em>calendar</em> types, which allow you
to represent calendar “dates” in various different ways.</p>
<p>The year-month-day calendar is the most common, it represents the
Gregorian calendar through a set of <em>components</em> like year,
month, and day.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[5]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-01" "2019-01-02" "2019-01-03" "2019-01-04" "2019-01-05"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, <span class="st">"last"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[12]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2020-01-31" "2020-02-29" "2020-03-31" "2020-04-30" "2020-05-31"</span></span>
<span><span class="co">#&gt;  [6] "2020-06-30" "2020-07-31" "2020-08-31" "2020-09-30" "2020-10-31"</span></span>
<span><span class="co">#&gt; [11] "2020-11-30" "2020-12-31"</span></span></code></pre></div>
<p>There are also calendars for:</p>
<ul>
<li><p>year-month-weekday: An alternative way to specify a Gregorian
date as year, month, and indexed day of the week (like the 3rd Sunday in
March). Great for specifying holidays.</p></li>
<li><p>year-day: An alternative way to specify a Gregorian date as year
and day of the year. Great for extracting the day of the year, or
grouping by the day of the year.</p></li>
<li><p>year-quarter-day: Great for quarterly financial data, or if you
have a fiscal year that starts in a different month from
January.</p></li>
<li><p>year-week-day: Allows you to specify a date using the year, week
number, day of the week, and a <code>start</code> value representing the
day that represents the start of the week.</p></li>
<li><p>iso-year-week-day: Follows the ISO week standard. Great if you
need to represent ISO weeks like <code>2020-W02</code>, or if you need
to extract out the ISO year which might differ from the Gregorian year.
Identical to year-week-day with <code>start</code> set to
Monday.</p></li>
</ul>
<p>Calendar types are great for instant retrieval of their underlying
components (year, month, day, etc), and for irregular calendrical
arithmetic with units such as years or months.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/duration-helper.html">duration_months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-02-02" "2019-03-02" "2019-04-02"</span></span></code></pre></div>
<p>The structure of calendar types also enables a unique feature among
date-time libraries, directly representing invalid dates. While adding 1
month to an R Date of 2019-03-31 requires setting an invalid date
resolution strategy, the year-month-day type can actually handle this
directly.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ymd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">31</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/duration-helper.html">duration_months</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">ymd</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-04-30" "2019-04-31"</span></span></code></pre></div>
<p>There are a family of functions for working with invalid dates:
<code><a href="../reference/clock-invalid.html">invalid_count()</a></code>, <code><a href="../reference/clock-invalid.html">invalid_any()</a></code>,
<code><a href="../reference/clock-invalid.html">invalid_detect()</a></code>, and <code><a href="../reference/clock-invalid.html">invalid_resolve()</a></code>.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/clock-invalid.html">invalid_count</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="../reference/clock-invalid.html">invalid_detect</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] FALSE  TRUE</span></span>
<span></span>
<span><span class="fu"><a href="../reference/clock-invalid.html">invalid_resolve</a></span><span class="op">(</span><span class="va">ymd</span>, invalid <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-04-30" "2019-04-30"</span></span>
<span><span class="fu"><a href="../reference/clock-invalid.html">invalid_resolve</a></span><span class="op">(</span><span class="va">ymd</span>, invalid <span class="op">=</span> <span class="st">"next"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;day&gt;[2]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-04-30" "2019-05-01"</span></span></code></pre></div>
<p>The <em>only</em> time in the entire low-level API that invalid dates
must be resolved is before converting to another type:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_sys_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't convert `x` to another type because some dates are</span></span>
<span><span class="co">#&gt;   invalid.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The following locations are invalid: 2.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Resolve invalid dates with `invalid_resolve()`.</span></span>
<span><span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_sys_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't convert `x` to another type because some dates are</span></span>
<span><span class="co">#&gt;   invalid.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The following locations are invalid: 2.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Resolve invalid dates with `invalid_resolve()`.</span></span>
<span><span class="fu"><a href="../reference/as_year_month_weekday.html">as_year_month_weekday</a></span><span class="op">(</span><span class="va">ymd</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `as_sys_time()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't convert `x` to another type because some dates are</span></span>
<span><span class="co">#&gt;   invalid.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> The following locations are invalid: 2.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Resolve invalid dates with `invalid_resolve()`.</span></span></code></pre></div>
<p>In the high-level API for R’s native date and date-time types, the
<code>invalid</code> argument is forced to bubble up in more places.
This trades the user benefit of being able to work directly on R’s
native date-time types for the side-effect of potentially having to deal
with this issue in more places.</p>
<p>For another example of invalid dates, imagine that your office is
planning on having a group meeting every 1st, 3rd, and 5th Friday of
every month in 2019. What days are those?</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1L</span>, <span class="fl">3L</span>, <span class="fl">5L</span><span class="op">)</span>,</span>
<span>  day <span class="op">=</span> <span class="va">clock_weekdays</span><span class="op">$</span><span class="va">friday</span>,</span>
<span>  month <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">12</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2019</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">meetings</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/year_month_weekday.html">year_month_weekday</a></span><span class="op">(</span><span class="va">grid</span><span class="op">$</span><span class="va">year</span>, <span class="va">grid</span><span class="op">$</span><span class="va">month</span>, <span class="va">grid</span><span class="op">$</span><span class="va">day</span>, <span class="va">grid</span><span class="op">$</span><span class="va">index</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meetings</span></span>
<span><span class="co">#&gt; &lt;year_month_weekday&lt;day&gt;[36]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2019-01-Fri[1]" "2019-01-Fri[3]" "2019-01-Fri[5]" "2019-02-Fri[1]"</span></span>
<span><span class="co">#&gt;  [5] "2019-02-Fri[3]" "2019-02-Fri[5]" "2019-03-Fri[1]" "2019-03-Fri[3]"</span></span>
<span><span class="co">#&gt;  [9] "2019-03-Fri[5]" "2019-04-Fri[1]" "2019-04-Fri[3]" "2019-04-Fri[5]"</span></span>
<span><span class="co">#&gt; [13] "2019-05-Fri[1]" "2019-05-Fri[3]" "2019-05-Fri[5]" "2019-06-Fri[1]"</span></span>
<span><span class="co">#&gt; [17] "2019-06-Fri[3]" "2019-06-Fri[5]" "2019-07-Fri[1]" "2019-07-Fri[3]"</span></span>
<span><span class="co">#&gt; [21] "2019-07-Fri[5]" "2019-08-Fri[1]" "2019-08-Fri[3]" "2019-08-Fri[5]"</span></span>
<span><span class="co">#&gt; [25] "2019-09-Fri[1]" "2019-09-Fri[3]" "2019-09-Fri[5]" "2019-10-Fri[1]"</span></span>
<span><span class="co">#&gt; [29] "2019-10-Fri[3]" "2019-10-Fri[5]" "2019-11-Fri[1]" "2019-11-Fri[3]"</span></span>
<span><span class="co">#&gt; [33] "2019-11-Fri[5]" "2019-12-Fri[1]" "2019-12-Fri[3]" "2019-12-Fri[5]"</span></span>
<span></span>
<span><span class="va">meetings</span><span class="op">[</span><span class="fu"><a href="../reference/clock-invalid.html">invalid_detect</a></span><span class="op">(</span><span class="va">meetings</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;year_month_weekday&lt;day&gt;[8]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-Fri[5]" "2019-02-Fri[5]" "2019-04-Fri[5]" "2019-06-Fri[5]"</span></span>
<span><span class="co">#&gt; [5] "2019-07-Fri[5]" "2019-09-Fri[5]" "2019-10-Fri[5]" "2019-12-Fri[5]"</span></span></code></pre></div>
<p>The year-month-weekday calendar allows us to quickly generate these
dates. We can see that we’ve generated 8 invalid dates - some months
don’t have a 5th Friday.</p>
<p>One option for handling these is to simply remove them. Less group
meetings!</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meetings</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="../reference/clock-invalid.html">invalid_detect</a></span><span class="op">(</span><span class="va">meetings</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;year_month_weekday&lt;day&gt;[28]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2019-01-Fri[1]" "2019-01-Fri[3]" "2019-02-Fri[1]" "2019-02-Fri[3]"</span></span>
<span><span class="co">#&gt;  [5] "2019-03-Fri[1]" "2019-03-Fri[3]" "2019-03-Fri[5]" "2019-04-Fri[1]"</span></span>
<span><span class="co">#&gt;  [9] "2019-04-Fri[3]" "2019-05-Fri[1]" "2019-05-Fri[3]" "2019-05-Fri[5]"</span></span>
<span><span class="co">#&gt; [13] "2019-06-Fri[1]" "2019-06-Fri[3]" "2019-07-Fri[1]" "2019-07-Fri[3]"</span></span>
<span><span class="co">#&gt; [17] "2019-08-Fri[1]" "2019-08-Fri[3]" "2019-08-Fri[5]" "2019-09-Fri[1]"</span></span>
<span><span class="co">#&gt; [21] "2019-09-Fri[3]" "2019-10-Fri[1]" "2019-10-Fri[3]" "2019-11-Fri[1]"</span></span>
<span><span class="co">#&gt; [25] "2019-11-Fri[3]" "2019-11-Fri[5]" "2019-12-Fri[1]" "2019-12-Fri[3]"</span></span></code></pre></div>
<p>Or, you could resolve them by selecting the previous valid day:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meetings_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clock-invalid.html">invalid_resolve</a></span><span class="op">(</span><span class="va">meetings</span>, invalid <span class="op">=</span> <span class="st">"previous"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meetings_valid</span></span>
<span><span class="co">#&gt; &lt;year_month_weekday&lt;day&gt;[36]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2019-01-Fri[1]" "2019-01-Fri[3]" "2019-01-Thu[5]" "2019-02-Fri[1]"</span></span>
<span><span class="co">#&gt;  [5] "2019-02-Fri[3]" "2019-02-Thu[4]" "2019-03-Fri[1]" "2019-03-Fri[3]"</span></span>
<span><span class="co">#&gt;  [9] "2019-03-Fri[5]" "2019-04-Fri[1]" "2019-04-Fri[3]" "2019-04-Tue[5]"</span></span>
<span><span class="co">#&gt; [13] "2019-05-Fri[1]" "2019-05-Fri[3]" "2019-05-Fri[5]" "2019-06-Fri[1]"</span></span>
<span><span class="co">#&gt; [17] "2019-06-Fri[3]" "2019-06-Sun[5]" "2019-07-Fri[1]" "2019-07-Fri[3]"</span></span>
<span><span class="co">#&gt; [21] "2019-07-Wed[5]" "2019-08-Fri[1]" "2019-08-Fri[3]" "2019-08-Fri[5]"</span></span>
<span><span class="co">#&gt; [25] "2019-09-Fri[1]" "2019-09-Fri[3]" "2019-09-Mon[5]" "2019-10-Fri[1]"</span></span>
<span><span class="co">#&gt; [29] "2019-10-Fri[3]" "2019-10-Thu[5]" "2019-11-Fri[1]" "2019-11-Fri[3]"</span></span>
<span><span class="co">#&gt; [33] "2019-11-Fri[5]" "2019-12-Fri[1]" "2019-12-Fri[3]" "2019-12-Tue[5]"</span></span></code></pre></div>
<p>If you didn’t want to meet on Saturday or Sunday, you could convert
to a naive-time and <em>shift</em> any Saturdays or Sundays to the
previous Friday.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meetings_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="va">meetings_valid</span><span class="op">)</span> </span>
<span><span class="va">meetings_wday</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_weekday.html">as_weekday</a></span><span class="op">(</span><span class="va">meetings_naive</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meetings_wday</span></span>
<span><span class="co">#&gt; &lt;weekday[36]&gt;</span></span>
<span><span class="co">#&gt;  [1] Fri Fri Thu Fri Fri Thu Fri Fri Fri Fri Fri Tue Fri Fri Fri Fri Fri</span></span>
<span><span class="co">#&gt; [18] Sun Fri Fri Wed Fri Fri Fri Fri Fri Mon Fri Fri Thu Fri Fri Fri Fri</span></span>
<span><span class="co">#&gt; [35] Fri Tue</span></span>
<span></span>
<span><span class="va">friday</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weekday.html">weekday</a></span><span class="op">(</span><span class="va">clock_weekdays</span><span class="op">$</span><span class="va">friday</span><span class="op">)</span></span>
<span><span class="va">saturday</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weekday.html">weekday</a></span><span class="op">(</span><span class="va">clock_weekdays</span><span class="op">$</span><span class="va">saturday</span><span class="op">)</span></span>
<span><span class="va">sunday</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/weekday.html">weekday</a></span><span class="op">(</span><span class="va">clock_weekdays</span><span class="op">$</span><span class="va">sunday</span><span class="op">)</span></span>
<span></span>
<span><span class="va">on_weekend</span> <span class="op">&lt;-</span> <span class="va">meetings_wday</span> <span class="op">==</span> <span class="va">saturday</span> <span class="op">|</span> <span class="va">meetings_wday</span> <span class="op">==</span> <span class="va">sunday</span></span>
<span></span>
<span><span class="va">meetings_naive</span><span class="op">[</span><span class="va">on_weekend</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/time_point_shift.html">time_point_shift</a></span><span class="op">(</span></span>
<span>  <span class="va">meetings_naive</span><span class="op">[</span><span class="va">on_weekend</span><span class="op">]</span>, </span>
<span>  target <span class="op">=</span> <span class="va">friday</span>,</span>
<span>  which <span class="op">=</span> <span class="st">"previous"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_year_month_weekday.html">as_year_month_weekday</a></span><span class="op">(</span><span class="va">meetings_naive</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_weekday&lt;day&gt;[36]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2019-01-Fri[1]" "2019-01-Fri[3]" "2019-01-Thu[5]" "2019-02-Fri[1]"</span></span>
<span><span class="co">#&gt;  [5] "2019-02-Fri[3]" "2019-02-Thu[4]" "2019-03-Fri[1]" "2019-03-Fri[3]"</span></span>
<span><span class="co">#&gt;  [9] "2019-03-Fri[5]" "2019-04-Fri[1]" "2019-04-Fri[3]" "2019-04-Tue[5]"</span></span>
<span><span class="co">#&gt; [13] "2019-05-Fri[1]" "2019-05-Fri[3]" "2019-05-Fri[5]" "2019-06-Fri[1]"</span></span>
<span><span class="co">#&gt; [17] "2019-06-Fri[3]" "2019-06-Fri[4]" "2019-07-Fri[1]" "2019-07-Fri[3]"</span></span>
<span><span class="co">#&gt; [21] "2019-07-Wed[5]" "2019-08-Fri[1]" "2019-08-Fri[3]" "2019-08-Fri[5]"</span></span>
<span><span class="co">#&gt; [25] "2019-09-Fri[1]" "2019-09-Fri[3]" "2019-09-Mon[5]" "2019-10-Fri[1]"</span></span>
<span><span class="co">#&gt; [29] "2019-10-Fri[3]" "2019-10-Thu[5]" "2019-11-Fri[1]" "2019-11-Fri[3]"</span></span>
<span><span class="co">#&gt; [33] "2019-11-Fri[5]" "2019-12-Fri[1]" "2019-12-Fri[3]" "2019-12-Tue[5]"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="variable-precision">Variable precision<a class="anchor" aria-label="anchor" href="#variable-precision"></a>
</h3>
<div class="section level4">
<h4 id="calendars">Calendars<a class="anchor" aria-label="anchor" href="#calendars"></a>
</h4>
<p>clock’s new types all have variable precision. Calendars, for
example, range in precision from year to nanosecond.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;year&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">01</span>, <span class="fl">01</span>, <span class="fl">02</span>, <span class="fl">30</span>, <span class="fl">50</span>, <span class="fl">123</span>, subsecond_precision <span class="op">=</span> <span class="st">"nanosecond"</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;nanosecond&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-01T02:30:50.000000123"</span></span></code></pre></div>
<p>A nice thing about this is that you get year-month and year-quarter
types for free.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_month_day&lt;month&gt;[5]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01" "2019-02" "2019-03" "2019-04" "2019-05"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/year_quarter_day.html">year_quarter_day</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;year_quarter_day&lt;January&gt;&lt;quarter&gt;[4]&gt;</span></span>
<span><span class="co">#&gt; [1] "2020-Q1" "2020-Q2" "2020-Q3" "2020-Q4"</span></span></code></pre></div>
<p>clock takes the worldview that a calendar at a specific precision
represents a <em>range</em> of values. Rather than assuming that a month
precision year-month-day would convert directly to a day precision
naive-time at the first of the month, you have to be explicit about
exactly what day you are talking about by first promoting that month
precision calendar up to day precision.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ym</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="va">ym</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Can't convert to a time point from a calendar with 'month' precision. A minimum of 'day' precision is required.</span></span>
<span></span>
<span><span class="co"># You might want the first of the month</span></span>
<span><span class="va">ym</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-setters.html">set_day</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;day&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-01" "2019-02-01" "2019-03-01"</span></span>
<span></span>
<span><span class="co"># Or the last</span></span>
<span><span class="va">ym</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/clock-setters.html">set_day</a></span><span class="op">(</span><span class="st">"last"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;day&gt;[3]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-31" "2019-02-28" "2019-03-31"</span></span></code></pre></div>
<p>This range assumption is all throughout clock. For example, grouping
a day precision iso-year-week-day by weeks returns a week precision
calendar.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/iso_year_week_day.html">iso_year_week_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/calendar_group.html">calendar_group</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"week"</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;iso_year_week_day&lt;week&gt;[10]&gt;</span></span>
<span><span class="co">#&gt;  [1] "2019-W01" "2019-W01" "2019-W03" "2019-W03" "2019-W05" "2019-W05"</span></span>
<span><span class="co">#&gt;  [7] "2019-W07" "2019-W07" "2019-W09" "2019-W09"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="time-points">Time points<a class="anchor" aria-label="anchor" href="#time-points"></a>
</h4>
<p>Time points, such as naive-time and sys-time, can vary in precision
from day to nanosecond.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;day&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-02"</span></span>
<span></span>
<span><span class="fu"><a href="../reference/as_sys_time.html">as_sys_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span></span>
<span>  <span class="fl">2019</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">30</span>, <span class="fl">35</span>, <span class="fl">123</span>, </span>
<span>  subsecond_precision <span class="op">=</span> <span class="st">"millisecond"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;sys_time&lt;millisecond&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-02-03T01:30:35.123"</span></span></code></pre></div>
<p>Unlike calendars, a time point at say, second precision, is
considered equivalent to a time point at millisecond precision with
millisecond information set to 0.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_sys_time.html">as_sys_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span></span>
<span>  <span class="fl">2019</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">30</span>, <span class="fl">35</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">milli</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/as_sys_time.html">as_sys_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span></span>
<span>  <span class="fl">2019</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">30</span>, <span class="fl">35</span>, <span class="fl">0</span>, </span>
<span>  subsecond_precision <span class="op">=</span> <span class="st">"millisecond"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sec</span> <span class="op">==</span> <span class="va">milli</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>This allows time points to naturally promote upwards to a more
precise precision when doing arithmetic with them:</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/as_naive_time.html">as_naive_time</a></span><span class="op">(</span><span class="fu"><a href="../reference/year_month_day.html">year_month_day</a></span><span class="op">(</span><span class="fl">2019</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="../reference/duration-helper.html">duration_nanoseconds</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;naive_time&lt;nanosecond&gt;[1]&gt;</span></span>
<span><span class="co">#&gt; [1] "2019-01-02T00:00:00.000000025"</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/DavisVaughan" class="external-link">Davis Vaughan</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
